
<!-- CRUD-->
<app-loading [condition]="isLoading"></app-loading>
<app-toast [message]="toast.message"></app-toast>
<div class="info_table col-md-12" >

  <div *ngIf="medics.length === 0 && !isLoading" class="animated bounceInRight">
    <h2>В базе данных еще нет врачей. Добавьте их</h2>
  </div>

  <div class="table-hover animated bounceInRight" *ngIf="!isEditing">
    <div class="example-header">
      <mat-input-container>
        <input matInput #filter placeholder="поиск">
      </mat-input-container>
    </div>

    <mat-table #table [dataSource]="dataSource" matSort>

      <!-- ChangeId Column -->
      <ng-container cdkColumnDef="name">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> Имя </mat-header-cell>
        <mat-cell *cdkCellDef="let row"> {{row.name}} </mat-cell>
      </ng-container>

      <!-- ChangeTitle Column -->
      <ng-container cdkColumnDef="sur">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> Фамилия </mat-header-cell>
        <mat-cell *cdkCellDef="let row"> {{row.sur}} </mat-cell>
      </ng-container>

      <!-- DateSubmitted -->
      <ng-container cdkColumnDef="spec">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> Специальность </mat-header-cell>
        <mat-cell *cdkCellDef="let row"> {{row.spec}} </mat-cell>
      </ng-container>

      <!-- ChangeSponsor -->
      <ng-container cdkColumnDef="hos">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> ЛПУ </mat-header-cell>
        <mat-cell *cdkCellDef="let row"> {{row.hos}} </mat-cell>
      </ng-container>

      <!-- ChangeDescription -->
      <ng-container cdkColumnDef="type">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> тип ЛПУ </mat-header-cell>
        <mat-cell *cdkCellDef="let row"> {{row.type}} </mat-cell>
      </ng-container>
      <!-- ChangeDescription -->
      <ng-container cdkColumnDef="local">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> Адрес </mat-header-cell>
        <mat-cell *cdkCellDef="let row"> {{row.local}} </mat-cell>
      </ng-container>
      <!-- ChangeDescription -->
      <ng-container cdkColumnDef="workTimeFrom">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> Р.в. с </mat-header-cell>
        <mat-cell *cdkCellDef="let row"> {{row.workTimeFrom}} </mat-cell>
      </ng-container>
      <!-- ChangeDescription -->
      <ng-container cdkColumnDef="workTimeTill">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> Р.в. до </mat-header-cell>
        <mat-cell *cdkCellDef="let row"> {{row.workTimeTill}} </mat-cell>
      </ng-container>
      <!-- ChangeDescription -->
      <ng-container cdkColumnDef="tel">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> Телефон </mat-header-cell>
        <mat-cell *cdkCellDef="let row"> {{row.tel}}</mat-cell>
      </ng-container>

      <ng-container cdkColumnDef="action">
        <mat-header-cell *cdkHeaderCellDef mat-sort-header> Действия </mat-header-cell>
        <mat-cell *cdkCellDef="let row">
          <button class="btn btn-sm btn-warning" (click)="enableEditing(row)">
            <i class="fa fa-pencil"></i> Редактировать
          </button>
          <button class="btn btn-sm btn-danger" (click)="deleteMedic(row)">
            <i class="fa fa-trash"></i> Удалить
          </button>
        </mat-cell>
      </ng-container>
      <!-- ChangeDescription -->

      <mat-header-row *cdkHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *cdkRowDef="let row; columns: displayedColumns;">
      </mat-row>
    </mat-table>

    <div class="example-no-results" [style.display]="dataSource?.renderedData.length == 0 ? '' : 'none'">
      Ничего не найденно по вашему запросу.
    </div>

    <mat-paginator #paginator [length]="dataSource?.filteredData.length" [pageIndex]="0" [pageSize]="25" [pageSizeOptions]="[5, 10, 25, 100]">
    </mat-paginator>
  </div>

  <div class="col-md-4 animated fadeInDown" *ngIf="isEditing">
    <form class="form-inline" #form="ngForm" (ngSubmit)="editMedic(medic)" style="display:inline">
      <mat-form-field>
            <span matTooltip="Введите имя" class="time">
              <input matInput class="mat-input-element" type="text" name="name" [(ngModel)]="medic.name" placeholder="Имя">
            </span>
      </mat-form-field>
      <mat-form-field>
            <span matTooltip="Введите фамилию" class="time">
              <input matInput class="mat-input-element" type="text" name="sur" [(ngModel)]="medic.sur" placeholder="Фамилия">
            </span>
      </mat-form-field>
      <mat-form-field>
            <span matTooltip="Выберите специальность">
              <mat-select [(ngModel)]="medic.spec" name="spec" placeholder="Специальность">
                <mat-option *ngFor="let spec of specs" [value]="spec.value">
                  {{ spec.viewValue }}
                </mat-option>
              </mat-select>
            </span>
      </mat-form-field>
      <mat-form-field>
            <span matTooltip="Выберите тип">
              <mat-select #selectedType [(ngModel)]="medic.type" name="type"  placeholder="Тип">
                <mat-option *ngFor="let spec of lpus | slice:0:3;" [value]="spec.type">
                  {{ spec.type }}
                </mat-option>
              </mat-select>
            </span>
      </mat-form-field>
      <mat-form-field>
            <span matTooltip="Выберите больницу">
              <mat-select  name="hos"  [(ngModel)]="medic.hos" placeholder="ЛПУ">
                <mat-option *ngFor="let spec of lpus" [value]="spec.name">
                  <span *ngIf="selectedType.value === spec.type">{{spec.name}}</span>
                </mat-option>
              </mat-select>
            </span>
      </mat-form-field>
      <mat-form-field>
            <span matTooltip="Введите адрес">
              <input matInput class="mat-input-element" type="text" name="local"  [(ngModel)]="medic.local"  placeholder="Адрес">
            </span>
      </mat-form-field>
      <span matTooltip="Введите телефон">
            <mat-form-field>
              <span style="color: #757575;" matPrefix>+996 &nbsp;</span>
              <input matInput class="mat-input-element" type="tel" name="tel" [(ngModel)]="medic.tel" placeholder="Телефон">
            </mat-form-field>
          </span>
      <mat-form-field class="time">
            <span matTooltip="Раб.время с">
              <input matInput name="workTimeFrom" [(ngModel)]="medic.workTimeFrom" class="mat-input-element" type="time" placeholder="Раб.время c">
            </span>
      </mat-form-field>
      <mat-form-field class="time">
            <span matTooltip="Раб.время до">
              <input matInput name="workTimeTill" [(ngModel)]="medic.workTimeTill" class="mat-input-element" type="time" placeholder="Раб.время до">
            </span>
      </mat-form-field>
      <button class="btn btn-sm btn-primary" type="submit" [disabled]="!form.form.valid"><i class="fa fa-floppy-o"></i> Сохранить</button>
    </form>
    <button class="btn btn-sm btn-warning" (click)="cancelEditing()"><i class="fa fa-times"></i> Отменить</button>
  </div>
  <div class="bg-over" *ngIf="isEditing" (click)="cancelEditing()"></div>
</div>
<mat-sidenav-container class="col-md-12 add-item" *ngIf="!isEditing">
  <div class="example-sidenav-content">
    <button mat-raised-button (click)="sidenav.open()">
      <mat-icon>add</mat-icon>Добавить нового врача
    </button>
  </div>
  <mat-sidenav #sidenav class="example-sidenav">
    <div class="addItem" *ngIf="!isEditing">
      <div>
        <form class="form-inline" [formGroup]="addMedicForm" (ngSubmit)="addMedic()" style="text-align:center">
          <mat-form-field>
              <span matTooltip="Введите имя">
                <input (click)="onlyCyrilick()" matInput class="mat-input-element" type="text" name="name" formControlName="name" placeholder="Имя">
              </span>
          </mat-form-field>
          <mat-form-field>
              <span matTooltip="Введите фамилию">
                <input (click)="onlyCyrilick()" matInput class="mat-input-element" type="text" name="sur" formControlName="sur" placeholder="Фамилия">
              </span>
          </mat-form-field>
          <mat-form-field>
              <span matTooltip="Выберите специальность">
                <mat-select formControlName="spec" placeholder="Специальность">
                  <mat-option *ngFor="let spec of specs" [value]="spec.value">
                    {{ spec.viewValue }}
                  </mat-option>
                </mat-select>
              </span>
          </mat-form-field>
          <mat-form-field>
              <span matTooltip="Выберите тип ЛПУ">
                <mat-select #selectedType formControlName="type" placeholder="Тип ЛПУ">
                  <mat-option *ngFor="let spec of lpus | slice:0:3;" [value]="spec.type">
                    {{ spec.type }}
                  </mat-option>
                </mat-select>
              </span>
          </mat-form-field>
          <mat-form-field *ngIf="selectedType.value !== undefined">
              <span matTooltip="Выберите больницу">
                <mat-select  formControlName="hos" placeholder="ЛПУ">
                  <mat-option *ngFor="let spec of lpus" [value]="spec.name">
                    <span *ngIf="selectedType.value === spec.type">{{spec.name}}</span>
                  </mat-option>
                </mat-select>
              </span>
          </mat-form-field>
          <mat-form-field>
              <span matTooltip="Введите адрес">
                <input matInput class="mat-input-element" type="text" name="local" formControlName="local" placeholder="Адрес">
              </span>
          </mat-form-field>
          <span matTooltip="Введите телефон">
              <mat-form-field>
                <span style="color: #757575;" matPrefix>+996 &nbsp;</span>
                <input matInput class="mat-input-element" type="number" min="5" name="tel" formControlName="tel" placeholder="Телефон" required>
              </mat-form-field>
            </span>
          <mat-form-field>
              <span matTooltip="Раб.время с">
                <input matInput formControlName="workTimeFrom" class="mat-input-element" type="time" placeholder="Раб.время c">
              </span>
          </mat-form-field>
          <mat-form-field>
              <span matTooltip="Раб.время до">
                <input matInput formControlName="workTimeTill" class="mat-input-element" type="time" placeholder="Раб.время до">
              </span>
          </mat-form-field>
          <button mat-raised-button color="warm" (click)="sidenav.close()" type="submit" [disabled]="!addMedicForm.valid"><i class="material-icons">add</i> Добавить</button>
        </form>
      </div>
    </div>
  </mat-sidenav>
</mat-sidenav-container>

<!--
<form class="form-inline searcher">
  <mat-form-field>
    <span matTooltip="Выберите категорию поиска">
      <mat-select #s name="search" placeholder="Категория поиска:">
        <mat-option *ngFor="let searchcat of searchcats;" [value]="searchcat.value">
          {{ searchcat.viewValue }}
        </mat-option>
      </mat-select>
    </span>
  </mat-form-field>
  <mat-form-field class="">
    <input (keyup)=(search($event.srcElement.value)) matInput placeholder="Поиск">
    <span matSuffix><i class="material-icons">search</i></span>
  </mat-form-field>
</form>


<app-loading [condition]="isLoading"></app-loading>
<app-toast [message]="toast.message"></app-toast>
<div class="info_table">
  <div class="animated bounceInRight" *ngIf="!isLoading">
    <h4 class="">Текущие врачи {{medics.length}}</h4>
    <div class="">
      <table class="table table-bordered table-striped">
        <thead class="thead-default"  *ngIf="!isEditing">
          <tr>
            <th>Имя</th>
            <th>Фамилия</th>
            <th>Специальность</th>
            <th>ЛПУ</th>
            <th>Тип</th>
            <th>Адрес</th>
            <th>Раб.время с</th>
            <th>Раб.время до</th>
            <th>Тел.</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody *ngIf="medics.length === 0">
          <tr>
            <td colspan="10">В базе данных еще нет врачей. Добавьте их</td>
          </tr>
        </tbody>
        <tbody class="result" *ngIf="!isEditing && !isSearching">
          <tr *ngFor="let medic of medics">
            <td>{{medic.name}}</td>
            <td>{{medic.sur}}</td>
            <td>{{medic.spec}}</td>
            <td>{{medic.hos}}</td>
            <td>{{medic.type}}</td>
            <td>{{medic.local}}</td>
            <td>{{medic.workTimeFrom}}</td>
            <td>{{medic.workTimeTill}}</td>
            <td>0 {{medic.tel}}</td>
            <td>
              <button class="btn btn-sm btn-warning" (click)="enableEditing(medic)">
                <i class="fa fa-pencil"></i> Редактировать
              </button>
              <button class="btn btn-sm btn-danger" (click)="deleteMedic(medic)">
                <i class="fa fa-trash"></i> Удалить
              </button>
            </td>
          </tr>
        </tbody>
        <tbody class="result" *ngIf="!isEditing && isSearching">
          <tr *ngFor="let medic of medics">

            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">{{medic.name}}</td>
            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">{{medic.sur}}</td>
            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">{{medic.spec}}</td>
            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">{{medic.hos}}</td>
            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">{{medic.type}}</td>
            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">{{medic.local}}</td>
            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">{{medic.workTimeFrom}}</td>
            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">{{medic.workTimeTill}}</td>
            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">0 {{medic.tel}}</td>
            <td *ngIf="medic[s.value] ? medic[s.value]?.toUpperCase().startsWith(searchItem) : medic.name.toUpperCase().startsWith(searchItem)">
              <button class="btn btn-sm btn-warning" (click)="enableEditing(medic)">
                <i class="fa fa-pencil"></i> Редактировать
              </button>
              <button class="btn btn-sm btn-danger" (click)="deleteMedic(medic)">
                <i class="fa fa-trash"></i> Удалить
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="col-md-4 animated fadeInDown" *ngIf="isEditing">
        <form class="form-inline" #form="ngForm" (ngSubmit)="editMedic(medic)" style="display:inline">
          <mat-form-field>
            <span matTooltip="Введите имя" class="time">
              <input matInput class="mat-input-element" type="text" name="name" [(ngModel)]="medic.name" placeholder="Имя">
            </span>
          </mat-form-field>
          <mat-form-field>
            <span matTooltip="Введите фамилию" class="time">
              <input matInput class="mat-input-element" type="text" name="sur" [(ngModel)]="medic.sur" placeholder="Фамилия">
            </span>
          </mat-form-field>
          <mat-form-field>
            <span matTooltip="Выберите специальность">
              <mat-select [(ngModel)]="medic.spec" name="spec" placeholder="Специальность">
                <mat-option *ngFor="let spec of specs" [value]="spec.value">
                  {{ spec.viewValue }}
                </mat-option>
              </mat-select>
            </span>
          </mat-form-field>
          <mat-form-field>
            <span matTooltip="Выберите тип">
              <mat-select #selectedType [(ngModel)]="medic.type" name="type"  placeholder="Тип">
                <mat-option *ngFor="let spec of lpus | slice:0:3;" [value]="spec.type">
                  {{ spec.type }}
                </mat-option>
              </mat-select>
            </span>
          </mat-form-field>
          <mat-form-field>
            <span matTooltip="Выберите больницу">
              <mat-select  name="hos"  [(ngModel)]="medic.hos" placeholder="ЛПУ">
                <mat-option *ngFor="let spec of lpus" [value]="spec.name">
                  <span *ngIf="selectedType.value === spec.type">{{spec.name}}</span>
                </mat-option>
              </mat-select>
            </span>
          </mat-form-field>
          <mat-form-field>
            <span matTooltip="Введите адрес">
              <input matInput class="mat-input-element" type="text" name="local"  [(ngModel)]="medic.local"  placeholder="Адрес">
            </span>
          </mat-form-field>
          <span matTooltip="Введите телефон">
            <mat-form-field>
              <span style="color: #757575;" matPrefix>+996 &nbsp;</span>
              <input matInput class="mat-input-element" type="tel" name="tel" [(ngModel)]="medic.tel" placeholder="Телефон">
            </mat-form-field>
          </span>
          <mat-form-field class="time">
            <span matTooltip="Раб.время с">
              <input matInput name="workTimeFrom" [(ngModel)]="medic.workTimeFrom" class="mat-input-element" type="time" placeholder="Раб.время c">
            </span>
          </mat-form-field>
          <mat-form-field class="time">
            <span matTooltip="Раб.время до">
              <input matInput name="workTimeTill" [(ngModel)]="medic.workTimeTill" class="mat-input-element" type="time" placeholder="Раб.время до">
            </span>
          </mat-form-field>
          <button class="btn btn-sm btn-primary" type="submit" [disabled]="!form.form.valid"><i class="fa fa-floppy-o"></i> Сохранить</button>
        </form>
        <button class="btn btn-sm btn-warning" (click)="cancelEditing()"><i class="fa fa-times"></i> Отменить</button>
      </div>
      <div class="bg-over" *ngIf="isEditing" (click)="cancelEditing()"></div>
    </div>
  </div>
  <mat-sidenav-container class="example-container" *ngIf="!isEditing">
    <div class="example-sidenav-content">
      <button mat-raised-button (click)="sidenav.open()">
        <mat-icon>add</mat-icon>Добавить нового врача
      </button>
    </div>
    <mat-sidenav #sidenav class="example-sidenav">
      <div class="addItem" *ngIf="!isEditing">
        <div>
          <form class="form-inline" [formGroup]="addMedicForm" (ngSubmit)="addMedic()" style="text-align:center">
            <mat-form-field>
              <span matTooltip="Введите имя">
                <input (click)="onlyCyrilick()" matInput class="mat-input-element" type="text" name="name" formControlName="name" placeholder="Имя">
              </span>
            </mat-form-field>
            <mat-form-field>
              <span matTooltip="Введите фамилию">
                <input (click)="onlyCyrilick()" matInput class="mat-input-element" type="text" name="sur" formControlName="sur" placeholder="Фамилия">
              </span>
            </mat-form-field>
            <mat-form-field>
              <span matTooltip="Выберите специальность">
                <mat-select formControlName="spec" placeholder="Специальность">
                  <mat-option *ngFor="let spec of specs" [value]="spec.value">
                    {{ spec.viewValue }}
                  </mat-option>
                </mat-select>
              </span>
            </mat-form-field>
            <mat-form-field>
              <span matTooltip="Выберите тип ЛПУ">
                <mat-select #selectedType formControlName="type" placeholder="Тип ЛПУ">
                  <mat-option *ngFor="let spec of lpus | slice:0:3;" [value]="spec.type">
                    {{ spec.type }}
                  </mat-option>
                </mat-select>
              </span>
            </mat-form-field>
            <mat-form-field *ngIf="selectedType.value !== undefined">
              <span matTooltip="Выберите больницу">
                <mat-select  formControlName="hos" placeholder="ЛПУ">
                  <mat-option *ngFor="let spec of lpus" [value]="spec.name">
                    <span *ngIf="selectedType.value === spec.type">{{spec.name}}</span>
                  </mat-option>
                </mat-select>
              </span>
            </mat-form-field>
            <mat-form-field>
              <span matTooltip="Введите адрес">
                <input matInput class="mat-input-element" type="text" name="local" formControlName="local" placeholder="Адрес">
              </span>
            </mat-form-field>
            <span matTooltip="Введите телефон">
              <mat-form-field>
                <span style="color: #757575;" matPrefix>+996 &nbsp;</span>
                <input matInput class="mat-input-element" type="number" min="5" name="tel" formControlName="tel" placeholder="Телефон" required>
              </mat-form-field>
            </span>
            <mat-form-field>
              <span matTooltip="Раб.время с">
                <input matInput formControlName="workTimeFrom" class="mat-input-element" type="time" placeholder="Раб.время c">
              </span>
            </mat-form-field>
            <mat-form-field>
              <span matTooltip="Раб.время до">
                <input matInput formControlName="workTimeTill" class="mat-input-element" type="time" placeholder="Раб.время до">
              </span>
            </mat-form-field>
            <button mat-raised-button color="warm" (click)="sidenav.close()" type="submit" [disabled]="!addMedicForm.valid"><i class="material-icons">add</i> Добавить</button>
          </form>
        </div>
      </div>
    </mat-sidenav>
  </mat-sidenav-container>
</div> -->
