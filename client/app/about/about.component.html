<div>
  <h4 class="page-title">Рабочий стол
    <span class="greeting-text float-right">{{auth.currentUser.username}}
      <br>Сегодня: {{todays}}</span>
  </h4>
</div>
<div class="col-md-12" *ngIf="auth.loggedIn && auth.isSalesAdmin">
  <div class="col-md-4">
    <app-loading [condition]="isLoading"></app-loading>
    <app-toast [message]="toast.message"></app-toast>

    <div class="info_table col-md-12">
      <div *ngIf="saleClients.length === 0 && !isLoading">
        <h5>В базе данных еще нет клиентов Добавьте их</h5>
      </div>
      <h6>Количество клиентов в базе: {{saleClients.length}}</h6>
      <!-- table  -->
      <div class="table-hover animated bounceInRight">

        <mat-grid-list cols="3" rowHeight="50">

            <mat-grid-tile>Ф.И.О.</mat-grid-tile>
            <mat-grid-tile>Адрес</mat-grid-tile>
            <mat-grid-tile>Действия</mat-grid-tile>

        </mat-grid-list>
        <mat-divider inset></mat-divider>

        <mat-grid-list cols="3" class="panel panel-default" rowHeight="50" *ngFor="let client of saleClients" [dropZones]="['user']" dnd-draggable [dragEnabled]="true" [dragData]="client">
          <mat-grid-tile>
            <mat-icon mat-list-icon>more_vert</mat-icon>
            {{client.name}}
          </mat-grid-tile>
          <mat-grid-tile>{{client.adress}}</mat-grid-tile>
          <mat-grid-tile>
            <button class="btn btn-sm btn-warning" data-toggle="modal" data-target='#editingItem' (click)="enableEditing(client)">
              <i class="material-icons">create</i>
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteSaleClient(client)">
              <i class="material-icons">delete_forever</i>
            </button>
          </mat-grid-tile>
        </mat-grid-list>
      </div>
      <!-- editingItem  -->
      <div class="modal fade" *ngIf="isEditing" id="editingItem" role="dialog">
        <div class="modal-dialog">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" #closeEdit class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Редактирование врача</h4>
            </div>
            <form class="form-inline" #form="ngForm" (ngSubmit)="editSaleClient(saleClient)" style="display:inline">
              <div class="modal-body">
                <mat-form-field>
                  <span matTooltip="Введите Ф.И.О." class="time">
                    <input matInput class="mat-input-element" name="name" [(ngModel)]="saleClient.name" placeholder="Ф.И.О.">
                  </span>
                </mat-form-field>
                <mat-form-field>
                  <span matTooltip="Введите Адрес">
                    <input matInput class="mat-input-element" name="adress" [(ngModel)]="saleClient.adress" placeholder="Адрес">
                  </span>
                </mat-form-field>
                <mat-form-field>
                  <span matTooltip="Введите whos">
                    <input matInput class="mat-input-element" name="whos" [(ngModel)]="saleClient.whos" placeholder="whos">
                  </span>
                </mat-form-field>
              </div>
              <div class="modal-footer">
                <button class="btn btn-sm btn-primary" (click)="closeEdit.click()" type="submit" [disabled]="!form.form.valid">
                  <i class="fa fa-floppy-o"></i> Сохранить</button>
                <button class="btn btn-sm btn-warning" (click)="cancelEditing();closeEdit.click()">
                  <i class="fa fa-times"></i> Отменить</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- addNewItem button -->
    <button class="add-item-button btn btn-sm btn-success" data-toggle="modal" data-target='#addNewItem'>
      <span>Добавить клиентово</span>
    </button>
    <!-- addNewItem -->
    <div class="modal fade" id="addNewItem" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Добавление нового клиентов</h4>
          </div>
          <div class="modal-body">
            <div class="addItem">
              <div>
                <form class="form-inline" [formGroup]="addSaleClientForm" (ngSubmit)="addSaleClient()" style="text-align:center">
                  <mat-form-field>
                    <span matTooltip="Введите Ф.И.О.">
                      <input matInput class="mat-input-element" name="name" formControlName="name" placeholder="Ф.И.О.">
                    </span>
                  </mat-form-field>
                  <mat-form-field>
                    <span matTooltip="Введите Адрес">
                      <input matInput class="mat-input-element" name="adress" formControlName="adress" placeholder="Адрес">
                    </span>
                  </mat-form-field>
                  <button mat-raised-button color="warm" type="submit" (click)="close.click()" [disabled]="!addSaleClientForm.valid">
                    <i class="material-icons">add</i> Добавить</button>
                </form>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" #close class="btn btn-sm btn-warning" data-dismiss="modal">Закрыть</button>
          </div>
        </div>
      </div>
    </div>

  </div>
  <div class="col-md-8">
    <div *ngFor="let item of users" [ngClass]="{'col-md-6' : item.role === 'user'}">
      <div *ngIf="item.role === 'user'">
        <div>
          <h2>{{item.username}}</h2>
          <div class="card" dnd-droppable [dropZones]="['user']" (onDropSuccess)="transferDataSuccess($event , item)">
            <div *ngFor="let client of saleClients">
                <div (click)="removeItem(client)" class="dragged-item" *ngIf="client.whos === item.username">{{client.name +  ' ' + client.adress}}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--<div class="col-md-12">
    <h4>Transfer custom data in Drag-and-Drop</h4>
    <div class="col-md-6">
      <div class="panel panel-warning" dnd-sortable-container [sortableData]="transferData" [dropZones]="['source-dropZone']">
        <div class="panel-heading">Available to drag</div>
        <div class="panel-body">
          <div *ngFor="let data of transferData; let x = index" class="panel panel-default" dnd-draggable [dragEnabled]="true" [dragData]="data"
            dnd-sortable [sortableIndex]="x">
            <div class="panel-body">
              <div>
                <i class="material-icons">more_vert</i>{{data.msg}}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div dnd-droppable class="panel panel-info" dnd-droppable [dropZones]="['source-dropZone']" (onDropSuccess)="transferDataSuccess($event)">
        <div class="panel-heading">Place to drop (Items:{{receivedData.length}})</div>
        <div class="panel-body">
          <div class="dragged-item" (click)="removeItem(data)" *ngFor="let data of receivedData; let y = index">{{data.msg}}</div>
        </div>
      </div>
    </div>
  </div>-->
  <app-tasks></app-tasks>
</div>
<!-- CRUD-->


<!-- <div class="col-md-12" *ngIf="auth.loggedIn && auth.isSalesAdmin">
    <button (click)="mapClick()">Показать Аптека №1</button>
    <button (click)="mapClick2()">Показать Аптека №2</button>
  <agm-map [zoom]="zoom" [latitude]="lat" [longitude]="lng">
    <agm-marker [visible]="showMarker"  [latitude]="lat" [longitude]="lng"></agm-marker>
    <agm-marker [visible]="showMarker2" [latitude]="lat2" [longitude]="lng2"></agm-marker>
  </agm-map>
</div> -->
